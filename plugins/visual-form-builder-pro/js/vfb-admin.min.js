jQuery(document).ready(function(h){if(window.VfbAdminPages){var g=VfbAdminPages.vfb_pages;if(pagenow==g["vfb-pro"]){h(".if-js-closed").removeClass("if-js-closed").addClass("closed");postboxes.add_postbox_toggles(g["vfb-pro"]);columns.useCheckboxesForHidden();columns.checked=function(q){h(".vfb-item-"+q).removeClass("hidden-field")};columns.unchecked=function(q){h(".vfb-item-"+q).addClass("hidden-field")};h(".hide-column-tog").not(":checked").each(function(){h("#vfb-menu-to-edit").find(".vfb-item-"+h(this).val()).addClass("hidden-field")})}h(document).on("change",g["vfb-pro"]+' .columns-prefs [type="radio"]',function(){if(3==h(this).val()){var q=h("#vfb-form-meta-preview iframe").contents().height();h("#vfb-form-meta-preview iframe").css({height:q})}})}h(function(){var s=h("#vfb-form-meta-preview iframe"),r=20;function q(){for(var u=0,t=s.length;u<t;u++){s[u].style.height=r+s[u].contentWindow.document.body.offsetHeight+"px"}}s.load(function(){this.style.height=r+this.contentWindow.document.body.offsetHeight+"px"})});function n(){h("#vfb-form-meta-preview iframe").attr("src",h("#vfb-form-meta-preview iframe").attr("src"))}h("select#switcher_form").change(function(){var q=window.location.href,r=h("option:selected",this).val(),s=q.replace(new RegExp(/(\d+)$/g),"")+r;window.location=s});var c=null;h(document).on("mouseenter mouseleave",".vfb-tooltip",function(t){if(t.type=="mouseenter"){if(c){clearTimeout(c);c=null}var q=h(this).attr("title"),s=h(this).attr("rel"),r=h(this).width();h(this).append('<div class="vfb-tooltip-popup"><h3>'+q+"</h3><p>"+s+"</p></div>");h.data(this,"title",q);this.title="";h(this).find(".vfb-tooltip-popup").css({left:r+22});c=setTimeout(function(){h(".vfb-tooltip-popup").fadeIn(300)},500)}else{this.title=h.data(this,"title");h(".vfb-tooltip-popup").fadeOut(500);h(this).children().remove()}});h(".vfb-color-picker").each(function(){var r=h(this),s=r.attr("id"),q=h("#"+s);q.wpColorPicker({change:function(t,u){q.css("background-color",u.color.toString())},clear:function(){q.css("background-color","")}})});h(".color:input").focus(function(){var r=h(this).attr("id"),q=r.replace(/vfb-/,"");h("#picker-"+q).show()}).blur(function(){var r=h(this).attr("id"),q=r.replace(/vfb-/,"");h("#picker-"+q).hide()});h(".email-design-default").click(function(u){u.preventDefault();var t=h(this),v=t.attr("id"),r=v.replace(/default/,""),s=t.text(),q;q=(t.hasClass("text-black"))?"black":"white";if(s==h("#vfb"+r).val()){q=""}h("#vfb"+r).val(s).css({"background-color":s,color:q})});h(document).on("change",".vfb-hidden-option",function(q){var r=h(this).attr("id").match(new RegExp(/(\d+)$/g),"");if(h(this).val()=="custom"){h("#static-var-"+r).show();h("#edit-form-item-staticvar-"+r).val("").prop("disabled",false)}else{h("#static-var-"+r).hide();h("#edit-form-item-staticvar-"+r).prop("disabled","disabled")}});h(document).on("change",".vfb-options-other",function(q){var r=h(this).attr("id").match(new RegExp(/(\d+)$/g),"");if(h(this).is(":checked")){h("#options-other-"+r).show();h("#options-other-"+r+" :input").prop("disabled",false)}else{h("#options-other-"+r).hide();h("#options-other-"+r+" :input").prop("disabled",true)}});h(document).on("click","a.vfb-add-option",function(w){w.preventDefault();var A=h(this).parent().siblings(".vfb-cloned-options"),s=A.children(),u=s.length,t=u+1,q=s[u-1],r=h(q).attr("id"),y=h(q).children("label").attr("for");var x=y.replace(new RegExp(/(\d+)$/g),""),v=r.replace(new RegExp(/(\d+)$/g),"");var z=h("#"+r).clone().attr("id",v+t);z.children("label").attr("for",x+t);z.find('input[type="text"]').attr("id",x+t);z.find('input[type="radio"]').attr("value",t);h("#"+v+u).after(z)});h(document).on("click","a.vfb-delete-option",function(r){r.preventDefault();var q=h(this).parent().parent().find(".vfb-cloned-option").length;if(q-1==0){alert("You must have at least one option.")}else{h(this).closest("div").remove()}});h(".vfb-cloned-options").sortable({items:"div.vfb-option",handle:".vfb-interface-sort"});h(document).on("click","a.addEmail",function(w){w.preventDefault();var r=h(this).closest("#email-details").find(".vfb-cloned-option").length;var v=r+1;var x=h(this).closest("div").attr("id");var u=h(this).closest("div").find("label").attr("for");var q=u.replace(new RegExp(/(\d+)$/g),"");var t=x.replace(new RegExp(/(\d+)$/g),"");var s=h("#"+x).clone().attr("id",t+v);s.find("label").attr("for",q+v);s.find("input").attr("id",q+v);h("#"+t+r).after(s)});h(document).on("click","a.deleteEmail",function(r){r.preventDefault();var q=h(this).closest("#email-details").find(".vfb-cloned-option").length;if(q-1==0){alert("You must have at least one option.")}else{h(this).closest("div").remove()}});h('.option input[type="radio"]').mousedown(function(){h(this).attr("previousValue",h(this).prop("checked"))}).click(function(){var q=h(this).attr("previousValue");if(q=="true"){h(this).prop("checked",false)}});h(document).on("click","a.item-edit",function(r){r.preventDefault();h(r.target).closest("li").children(".menu-item-settings").slideToggle("fast");h(this).toggleClass("opened");var q=h(r.target).closest("dl");if(q.hasClass("vfb-menu-item-inactive")){q.removeClass("vfb-menu-item-inactive").addClass("vfb-menu-item-active")}else{q.removeClass("vfb-menu-item-active").addClass("vfb-menu-item-inactive")}});h("a.vfb-bulking").click(function(q){q.preventDefault();h("#choicesText").val("")});h(document).on("click","a.vfb-bulk-options",function(r){r.preventDefault();var q=[];h(this).parent().find("li").each(function(s){q.push(h(this).text())});h("#choicesText").val(q.join("\n"))});h(document).on("submit","#vfb_bulk_add_options",function(w){w.preventDefault();var B="#form-item-settings-"+h("#bulk-add-field-id").val(),A=h(B+" .vfb-cloned-options"),s=A.children(),u=s.length,q=s[u-1],r=h(q).attr("id"),y=h(q).children("label").attr("for");var D=h("#choicesText").val(),C=D.split("\n"),t=u+1,x=y.replace(new RegExp(/(\d+)$/g),""),v=r.replace(new RegExp(/(\d+)$/g),""),z=[];for(i=0;i<C.length;++i){z[i]=h("#"+r).clone().attr("id",v+t);z[i].children("label").attr("for",x+t);z[i].find('input[type="text"]').attr("id",x+t);z[i].find('input[type="text"]').attr("value",C[i]);z[i].find('input[type="radio"]').attr("value",t);t++}h("#"+r).after(z);window.tb_remove()});h("#vfb-main").sortable({placeholder:"vfb-sortable-placeholder",items:"div.form-boxes:not(.ui-state-disabled)",stop:function(q,r){h.post(ajaxurl,{action:"visual_form_builder_form_order",order:h(this).sortable("toArray")})}});function p(q){if("FIELDSET"!==q){h("#vfb-fieldset-first-warning").show()}else{h("#vfb-fieldset-first-warning").hide()}}h("#form-items .vfb-draggable-form-items").draggable({connectToSortable:"#vfb-menu-to-edit",helper:function(){var q='<dl class="menu-item-bar"><dt class="vfb-menu-item-handle"><span class="item-title">'+h(this).text()+"</span></dt></dl>";return q},distance:2,zIndex:5,cursorAt:{top:20},containment:"document"});h("#vfb-menu-to-edit").nestedSortable({listType:"ul",maxLevels:3,handle:".vfb-menu-item-handle",placeholder:"vfb-sortable-placeholder",forcePlaceholderSize:true,forceHelperSize:true,tolerance:"pointer",toleranceElement:"> dl",items:"li:not(.ui-state-disabled)",create:function(q,r){h(this).css("min-height",h(this).height())},start:function(q,r){if(!h(r.item).hasClass("vfb-draggable-form-items")){r.placeholder.height(r.item.height())}},stop:function(s,t){var r=h("#vfb-menu-to-edit .item-type:first").text();if(t.item.hasClass("ui-draggable")){t.item.hide();var w=h("#form-items").serializeArray(),v=t.item.text(),u=$previous=$next="",q=t.item;if(q.closest("li.form-item").size()>0){u=q.closest("li.form-item").attr("id").match(new RegExp(/(\d+)$/g))[0]}if(q.prev().size()>0){$previous=q.prev().attr("id").match(new RegExp(/(\d+)$/g))[0]}opts={url:ajaxurl,type:"POST",async:true,cache:false,dataType:"html",data:{action:"visual_form_builder_create_field",order:h(this).nestedSortable("toArray"),data:w,field_type:v,page:pagenow,parent:u,previous:$previous,nonce:h("#_wpnonce").val()},success:function(y){h("#loading-animation").hide();var z=h(y),x=z.closest("li.form-item").attr("id");z.hide().insertBefore(q);h("#"+x).fadeIn();q.remove();if(z.prev().hasClass("ui-state-disabled")){z.hide().insertBefore("#vfb-menu-to-edit li.ui-state-disabled:first").fadeIn()}n();return}}}else{opts={url:ajaxurl,type:"POST",async:true,cache:false,data:{action:"visual_form_builder_sort_field",order:h(this).nestedSortable("toArray")},success:function(x){h("#loading-animation").hide();p(r);n();return}}}h.ajax(opts);l()}});h("#form-items .vfb-draggable-form-items").click(function(q){q.preventDefault();h(this).data("submit_value",h(this).text())});h("#form-items .vfb-draggable-form-items").click(function(s){s.preventDefault();var t=h(this).closest("form").serializeArray(),r=h(this).data("submit_value"),q=h("#vfb-menu-to-edit li.ui-state-disabled:first").attr("id").match(new RegExp(/(\d+)$/g))[0];h("img.waiting").show();h.post(ajaxurl,{action:"visual_form_builder_create_field",data:t,field_type:r,previous:q,page:pagenow,nonce:h("#_wpnonce").val()}).done(function(u){h("img.waiting").hide();h(u).hide().insertBefore("#vfb-menu-to-edit li.ui-state-disabled:first").fadeIn();n()})});h(document).on("click","a.item-delete",function(y){y.preventDefault();var v=childs=new Array(),C=0,r=h(this).attr("href"),q=r.split("&"),x=confirm("You are about to permanently delete this field.\n'Cancel' to stop, 'OK' to delete.");if(!x){return false}for(var w=0;w<q.length;w++){var A=q[w].indexOf("=");var z=q[w].substring(0,A);var B=q[w].substring(A+1);v[z]=B}var s=h(this).closest(".form-item").find("ul").children();var u=s.parent().html();s.each(function(t){childs[t]=h(this).attr("id").match(new RegExp(/(\d+)$/g))[0]});var D=h(this).closest("li.form-item").parents("li.form-item");if(D.length){C=D.attr("id").match(new RegExp(/(\d+)$/g))[0]}h.post(ajaxurl,{action:"visual_form_builder_delete_field",form:v.form,field:v.field,child_ids:childs,parent_id:C,page:pagenow,nonce:v._wpnonce}).done(function(t){h("#form_item_"+v.field).addClass("deleting").animate({opacity:0,height:0},350,function(){h(this).before(u).remove()});n()})});h(document).on("click","a.vfb-duplicate-field",function(w){w.preventDefault();var v=new Array(),r=h(this).attr("href"),s=r.split("&");for(var t=0;t<s.length;t++){var x=s[t].indexOf("=");var q=s[t].substring(0,x);var u=s[t].substring(x+1);v[q]=u}h("img.waiting").show();h.post(ajaxurl,{action:"visual_form_builder_duplicate_field",form:v.form,field:v.field,page:pagenow,nonce:v._wpnonce}).done(function(z){h("img.waiting").hide();var y=h(z).closest("li.form-item").attr("id");h(z).hide().insertAfter("#form_item_"+v.field);h("#"+y).fadeIn();n()})});h(document).on("change","#vfb-email-rule-setting",function(q){h("#vfb-build-email-rules-container").toggle(h(this).prop("checked"))});h(document).on("click","a.vfb-add-email-rule",function(s){s.preventDefault();var r=h(this).parent(),q=r.find("select");num=h(this).parent().parent().find(".vfb-email-rules-data").length,newNum=num+1,newElem=r.clone();newElem.find('input[type="text"]').each(function(t,u){this.name=this.name.replace(/\[(\d+)\]/,"["+num+"]")});newElem.find("select").each(function(t,u){this.name=this.name.replace(/\[(\d+)\]/,"["+num+"]");h(u).val(q.eq(t).val())});h(r).after(newElem)});h(document).on("click","a.vfb-delete-email-rule",function(s){s.preventDefault();var q=h(this).closest("#vfb-build-email-rules-container").find(".vfb-email-rules-data").length;if(q-1==0){alert("You must have at least one rule.")}else{h(this).closest("div").remove();var r=h("#vfb-build-email-rules-container").find(".vfb-email-rules-data");r.each(function(t){h(this).find("select").each(function(){h(this).attr("name").replace(/\[(\d+)\]/,"["+t+"]")});h(this).find('input[type="text"]').attr("name").replace(/\[(\d+)\]/,"["+q+"]")})}});h(document).on("submit","#vfb-add-email-rules",function(q){q.preventDefault();var r=h(this).closest("form").serialize();h("#vfb-saving-email-rule img").show();h("#vfb-saving-email-rule-error").html("");h.post(ajaxurl,{action:"visual_form_builder_email_rules_save",data:r,page:pagenow}).done(function(s){h("#vfb-saving-email-rule img").hide();if(s){h("#vfb-saving-email-rule-error").html(s)}})});h(document).on("click",".vfb-show-field-rules",function(q){q.preventDefault();h(this).parent().hide();h("#vfb-build-conditional-fields-container").show()});h(document).on("change","#vfb-conditional-setting",function(q){h("#vfb-build-conditional-fields-container").toggle(h(this).prop("checked"))});h(document).on("change",".vfb-conditional-other-fields",function(s){var r=h(this).val(),q=h(this).parent().children(".vfb-conditional-other-fields-options");h.post(ajaxurl,{action:"visual_form_builder_conditional_fields_options",field_id:r,page:pagenow}).done(function(t){q.empty().append(t)})});h(document).on("click","a.vfb-add-condition",function(v){v.preventDefault();var t=h(this).parent(),q=t.find("select"),r=h(this).parent().parent().find(".vfb-conditional-fields-data").length,u=r+1,s=t.clone();s.find("select").each(function(w,x){this.name=this.name.replace(/\[(\d+)\]/,"["+r+"]");h(x).val(q.eq(w).val())});h(t).after(s)});h(document).on("click","a.vfb-delete-condition",function(s){s.preventDefault();var q=h(this).closest("#vfb-build-conditional-fields-container").find(".vfb-conditional-fields-data").length;if(q-1==0){alert("You must have at least one rule.")}else{h(this).closest("div").remove();var r=h("#vfb-build-conditional-fields-container").find(".vfb-conditional-fields-data");r.each(function(t){h(this).find("select").each(function(){h(this).attr("name").replace(/\[(\d+)\]/,"["+t+"]")})})}});h(document).on("submit","#vfb-add-conditional-fields",function(q){q.preventDefault();var r=h(this).closest("form").serialize();h("#vfb-saving-conditional img").show();h("#vfb-saving-conditonal-error").html("");h.post(ajaxurl,{action:"visual_form_builder_conditional_fields_save",data:r,page:pagenow}).done(function(s){h("#vfb-saving-conditional img").hide();if(s){h("#vfb-saving-conditonal-error").html(s)}})});h("#form-settings-button").click(function(s){s.preventDefault();h(this).toggleClass("current");h("#form-settings").slideToggle("fast");var q=h('input[name="form_id"]').val(),r=(h(this).hasClass("current"))?"opened":"closed";h.post(ajaxurl,{action:"visual_form_builder_form_settings",form:q,status:r,page:pagenow}).done(function(t){if(r=="closed"){h(".settings-links").removeClass("on");h(".settings-links:first").addClass("on");h(".form-details").slideUp("fast");h(".form-details:first").show("fast")}})});h(".settings-links").click(function(s){s.preventDefault();h(".settings-links").removeClass("on");h(".form-details").slideUp("fast");if(h(this).next("div").is(":hidden")==true){h(this).addClass("on");h(this).next().slideDown("fast")}var r=h('input[name="form_id"]').val(),q=this.hash.replace(/#/g,"");h.post(ajaxurl,{action:"visual_form_builder_form_settings",form:r,accordion:q,page:pagenow})});var b=false;h("#vfb-form-builder-management input, #vfb-form-builder-management select, #vfb-form-builder-management textarea").change(function(){l()});function l(){b=true}window.onbeforeunload=function(){if(b){return"The changes you made will be lost if you navigate away from this page."}};h(document).on("submit","#visual-form-builder-update",function(){window.onbeforeunload=null});if(h(".columns-2 #side-sortables, .columns-3 #side-sortables").length>0){var a=h("#vfb_form_items_meta_box"),d=a.width(),e=a.offset(),f=a.nextAll(),j=false;h(window).on("scroll",function(){if(h(window).scrollTop()>e.top){a.stop().css({top:55,position:"fixed","z-index":"1",width:d});if(f.is(":visible")){j=true;f.stop().css({opacity:0.1})}}else{a.stop().css({top:0,position:"relative"});if(j){f.stop().css({opacity:1})}}})}var o=h(".form-success-type:checked").val();switch(o){case"text":case"display-entry":h("#form-success-message-text").show();break;default:h("#form-success-message-"+o).show();break}h(".form-success-type").change(function(){var q=h(this).val();switch(q){case"text":case"display-entry":h("#form-success-message-text").show();h("#form-success-message-page, #form-success-message-redirect").hide();break;case"page":h("#form-success-message-page").show();h("#form-success-message-text, #form-success-message-redirect").hide();break;case"redirect":h("#form-success-message-redirect").show();h("#form-success-message-text, #form-success-message-page").hide();break}});h(".vfb-field-types").click(function(r){r.preventDefault();h("#vfb-field-tabs li").removeClass("tabs");h(this).parent().addClass("tabs");h(".tabs-panel-active").removeClass("tabs-panel-active").addClass("tabs-panel-inactive");var q=this.hash;h(q).removeClass("tabs-panel-inactive").addClass("tabs-panel-active")});h("#visual-form-builder-update").validate({rules:{"form_email_to[]":{email:true},form_email_from:{email:true},form_success_message_redirect:{url:true},form_notification_email_name:{required:function(q){return h("#form-notification-setting").is(":checked")}},form_notification_email_from:{required:function(q){return h("#form-notification-setting").is(":checked")},email:true},form_notification_email:{required:function(q){return h("#form-notification-setting").is(":checked")}},form_entries_allowed:{digits:true}},messages:{form_entries_allowed:"Please enter only digits or leave blank for unlimited entries."},errorClass:"vfb-error",errorPlacement:function(q,r){q.insertAfter(r.parent())}});h("#visual-form-builder-new-form").validate({errorClass:"vfb-error"});h("#form-entries-schedule-start").datetimepicker({controlType:"select",showTime:false});h("#form-entries-schedule-end").datetimepicker({controlType:"select",showTime:false});h("#form_email_from_name_override").change(function(){if(h("#form_email_from_name_override").val()==""){h("#form-email-sender-name").prop("readonly",false)}else{h("#form-email-sender-name").prop("readonly","readonly")}});h("#form_email_from_override").change(function(){if(h("#form_email_from_override").val()==""){h("#form-email-sender").prop("readonly",false)}else{h("#form-email-sender").prop("readonly","readonly")}});h("#notification-email").toggle(h("#form-notification-setting").prop("checked"));h("#form-notification-setting").change(function(){var q=h(this).is(":checked");if(q){h("#notification-email").show();h("#form-notification-email-name, #form-notification-email-from, #form-notification-email, #form-notification-subject, #form-notification-message, #form-notification-entry").prop("disabled",false)}else{h("#notification-email").hide();h("#form-notification-email-name, #form-notification-email-from, #form-notification-email, #form-notification-subject, #form-notification-message, #form-notification-entry").prop("disabled","disabled")}});h("#paypal-setup").toggle(h("#form-paypal-setting").prop("checked"));h("#form-paypal-setting").change(function(){var q=h(this).is(":checked");if(q){h("#paypal-setup").show();h("#form-paypal-email, #form-paypal-currency, #form-paypal-shipping, #form-paypal-tax, #form-paypal-field-price").prop("disabled",false)}else{h("#paypal-setup").hide();h("#form-paypal-email, #form-paypal-currency, #form-paypal-shipping, #form-paypal-tax, #form-paypal-field-price").prop("disabled","disabled")}});if(h("#form-paypal-field-price").val()!==""){h(".assigned-price").show()}else{h(".assigned-price").hide()}h("#form-paypal-field-price").change(function(){var q=h(this).val();h("#paypal-price-switch").show();h.get(ajaxurl,{action:"visual_form_builder_paypal_price",form_id:h('input[name="form_id"]').val(),field_id:q}).done(function(r){h(".assigned-price").show().html(r);h("#paypal-price-switch").hide()})});var k=h("#vfb-export").find(".vfb-export-filters");h("#vfb-export").find("input:radio").change(function(){k.slideUp("fast");switch(h(this).val()){case"forms":h("#forms-filters").slideDown();break;case"entries":h("#entries-filters").slideDown();break}});h("#vfb-export-select-all").click(function(q){q.preventDefault();h('#vfb-export-entries-fields input[type="checkbox"]').prop("checked",true)});h("#vfb-export-unselect-all").click(function(q){q.preventDefault();h('#vfb-export-entries-fields input[type="checkbox"]').prop("checked",false)});h("#vfb-export-entries-forms").change(function(){var r=h(this).val(),q=m(r);h("#vfb-export-entries-fields").html("Loading...");h.get(ajaxurl,{action:"visual_form_builder_export_load_options",id:r,count:q,page:pagenow}).done(function(s){h("#vfb-export-entries-fields").html(s)}).fail(function(s){h("#vfb-export-entries-fields").html("Error loading entry fields.")})});h("#vfb-export-entries-rows").change(function(){var r=h("#vfb-export-entries-forms").val();var q=h(this).val();h("#vfb-export-entries-fields").html("Loading...");h.get(ajaxurl,{action:"visual_form_builder_export_load_options",id:r,offset:q,page:pagenow}).done(function(s){h("#vfb-export-entries-fields").html(s)}).fail(function(s){h("#vfb-export-entries-fields").html("Error loading entry fields.")})});function m(r){var q="";h.ajax(ajaxurl,{async:false,data:{action:"visual_form_builder_export_entries_count",id:r,page:pagenow}}).done(function(s){if(s>1000){h("#vfb-export-entries-rows").empty();var u=Math.ceil(parseInt(s)/1000);for(var t=1;t<=u;t++){h("#vfb-export-entries-rows").append(h("<option></option>").attr("value",t).text(t))}h("#vfb-export-entries-pages").show()}else{h("#vfb-export-entries-pages").hide()}q=s}).fail(function(s){});return q}});